var TurnerSpotifyApp=angular.module("TurnerSpotifyApp",["ngRoute","TurnerAppCtrller"]);TurnerSpotifyApp.config(["$routeProvider",function(t){t.when("/index",{templateUrl:"app/view/artist.html",controller:"artistCtrl"}).when("/artist/:artistId",{templateUrl:"app/view/albums.html",controller:"albumCtrl"}).when("/album/:albumId",{templateUrl:"app/view/tracks.html",controller:"trackCtrl"}).otherwise({redirectTo:"/index"})}]),TurnerSpotifyApp.run(["$rootScope",function(t){t.Favs={artists:{},albums:{},tracks:{}},t.favlists=function(){$("#favorites ul").html(null);var r=LocalStorage.getFavorites();angular.forEach(r,function(r,a){console.log(r),t.Favs[a]=r;var e=$("#favorites").find("."+a+" ul");angular.forEach(r,function(t,r){e.append("<li data-id='"+r+"'>"+t+"<i class='fa fa-times-circle'></i><li>")})})},$("body").on("click","#favorites i",function(t){var r=$(t.currentTarget),a=r.parent(),e=a.attr("data-id"),i=r.closest("section").attr("class"),s=LocalStorage.getFavorites();s[i][e]&&delete s[i][e],LocalStorage.setFavorites(s),a.remove()})}]);var Labels={APP_TITLE:"Turner Spotify App Demo",SEARCH_LABEL:"Search by Artist Name"},NO_USER_PIC="app/img/no_user_pic.jpg",NO_ALBUM_PIC="app/img/no_album_pic.jpg";TurnerSpotifyApp.directive("favorites",["$rootScope",function(t){return{restrict:"AE",replace:"true",template:'<a class="favs" href="#"><i class="fa fa-star"></i>Add to Favorites</a>',link:function(r,a,e){a.bind("click",function(r){r.preventDefault();var i=$("#favorites"),s=a.closest("li");if(e.type){switch(e.type){case"album":var n=e.type+"_"+e.albumid;if(LocalStorage.isAlbumExists(n))return!1;var o=s.find("figcaption").text();t.Favs.albums[n]=o,i.find(".albums ul").append("<li>"+o+"<i class='fa fa-times-circle'></i><li>");break;case"artist":var n=e.type+"_"+e.artistid;if(LocalStorage.isArtistExists(n))return!1;var o=s.find("figcaption").text();t.Favs.artists[n]=o,i.find(".artists ul").append("<li>"+o+"<i class='fa fa-times-circle'></i><li>");break;case"track":var n=e.type+"_"+e.trackid;if(LocalStorage.isTrackExists(n))return!1;var o=s.find(".track").text();t.Favs.tracks[n]=o,i.find(".tracks ul").append("<li>"+o+"<i class='fa fa-times-circle'></i><li>")}LocalStorage.setFavorites(t.Favs)}})}}}]);var LocalStorage=function(){var t=window.localStorage||{},r="artists",a="albums",e="tracks",i="favorites";return{setItem:function(r,a){t.setItem(r,JSON.stringify(a))},getItem:function(r){return JSON.parse(t.getItem(r))},isItemExists:function(t){return this.getItem(t)?1:0},clearItem:function(r){this.isItemExists(r)&&delete t[r]},isFavExists:function(t,r){if(this.isItemExists(i)){var a=this.getItem(i);if(void 0!=a[t])return a[t][r]?1:0}return!1},isAlbumExists:function(t){return this.isFavExists(a,t)},isArtistExists:function(t){return this.isFavExists(r,t)},isTrackExists:function(t){return this.isFavExists(e,t)},setFavorites:function(r){t.setItem(i,JSON.stringify(r))},getFavorites:function(){return JSON.parse(t.getItem(i))}}}(),apiHost="https://api.spotify.com",ServiceUrls={search:apiHost+"/v1/search/",albums:apiHost+"/v1/artists/{%id%}/albums",tracks:apiHost+"/v1/albums/{%id%}/tracks"},ServiceActions={search:0,albums:1,tracks:2},app=angular.module("Turner.services",[]);app.factory("tServices",["$http","$q",function(t){return function(){function r(r){t.get(a,{params:i}).success(function(t){r(e,t)}).error(function(t){r(e,t)})}var a,e,i;return{call:function(t,a){r(t,a)},setFileUrl:function(t){a=t},setAction:function(t){e=t},setParams:function(t){i=t}}}}]);var JSONParser=function(){return{searchResponse:function(t){var r=t.artists&&t.artists.items?t.artists.items:[];if(!r.length)return!1;var a=[],e={};return angular.forEach(r,function(t){var r={artist_name:t.name,artist_image:t.images[1]&&t.images[1].url?t.images[1].url:t.images[0]&&t.images[0].url?t.images[0].url:t.images[2]&&t.images[2].url?t.images[1].url:NO_USER_PIC,artist_id:t.id};a.push(r)}),void 0!=t.artists&&($page={next:t.artists.next,prev:t.artists.previous}),e={items:a,page:$page}},albumResponse:function(t){var r=t.items||[];if(!r.length)return!1;var a=[],e={};return angular.forEach(r,function(t){var r={album_name:t.name,album_image:t.images[1]&&t.images[1].url?t.images[1].url:t.images[0]&&t.images[0].url?t.images[0].url:t.images[2]&&t.images[2].url?t.images[1].url:NO_ALBUM_PIC,album_id:t.id};a.push(r)}),$page={next:t.next,prev:t.previous},e={items:a,page:$page}},trackResponse:function(t){var r=t.items||[];if(!r.length)return!1;var a=[];return angular.forEach(r,function(t){var r={track_name:t.name,track_id:t.id,track_url:t.preview_url};a.push(r)}),a}}}(),modal=angular.module("Turner.modal",["Turner.services"]);modal.factory("tModal",["tServices",function(t){function r(r,s,n,o){void 0==i[r]&&(i[r]={}),i[r]=n;var l=new t;l.setFileUrl(s),l.setAction(r),l.setParams(o),l.call(a,e)}function a(t,r){var a={};switch(t){case ServiceActions.search:var e=JSONParser.searchResponse(r);a={data:e.items,page:e.page};break;case ServiceActions.albums:var e=JSONParser.albumResponse(r);a={data:e.items,page:e.page};break;case ServiceActions.tracks:a={data:JSONParser.trackResponse(r)}}i[t].call(this,a)}function e(t,r){console.error("******** Error Happended with service ["+t+"] ********"),console.log(r)}var i={};return{init:function(t,a,e,i){r(t,a,e,i)}}}]);var TurnerAppCtrller=angular.module("TurnerAppCtrller",["Turner.modal"]);TurnerAppCtrller.controller("albumCtrl",["$rootScope","$scope","$routeParams","tModal","$window",function(t,r,a,e){var i=function(){function i(){r.albums=[],t.home=!0,t.labels=Labels,t.favlists();var e=a.artistId;r.url=ServiceUrls.albums.replace("{%id%}",e),s(),r.paginate=function(t){t.preventDefault();var a=$(t.currentTarget).attr("data-page");a&&(r.url=a,s())}}function s(){function t(t){console.log(t),r.albums=t.data,r.page=t.page}var a={};e.init(ServiceActions.albums,r.url,t,a)}return{start:i}}();angular.element(document).ready(function(){i.start()})}]),TurnerAppCtrller.controller("artistCtrl",["$rootScope","$scope","tModal","$window",function(t,r,a){var e=function(){function e(){r.artists=[],t.home=!1,t.labels=Labels,t.favlists(),r.url=ServiceUrls.search,r.searchArtist=i,r.paginate=function(t){t.preventDefault();var a=$(t.currentTarget).attr("data-page");a&&(r.url=a,i())}}function i(t){function e(t){$(".search-box.abs-center").addClass("no-abs-center"),$(".navs").removeClass("hide"),r.artists=t.data,r.page=t.page}var i=$("#search-query").val(),s={};void 0!=t&&(s={q:i,type:"Artist"}),a.init(ServiceActions.search,r.url,e,s)}return{start:e}}();angular.element(document).ready(function(){e.start()})}]),TurnerAppCtrller.controller("trackCtrl",["$rootScope","$scope","$routeParams","tModal","$window",function(t,r,a,e){var i=function(){function i(){r.tracks=[],t.home=!0,t.labels=Labels,t.favlists(),s(a.albumId),r.play=function(t){t.preventDefault();var r=$(t.currentTarget),a=r.attr("data-url");a?($("#audio-player").attr("src",a),$("#audio-player").get(0).play()):console.log("No play url found!")}}function s(t){function a(t){console.log(t),r.tracks=t.data}var i={},s=ServiceUrls.tracks.replace("{%id%}",t);e.init(ServiceActions.tracks,s,a,i)}return{start:i}}();angular.element(document).ready(function(){i.start()})}]);